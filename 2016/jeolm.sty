\NeedsTeXFormat{LaTeX2e}[2009/09/24]
\ProvidesPackage{jeolm}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\newlength\@kratno@height
\newcommand\@kratno@template[2]{\setlength{\@kratno@height}{#2pt}%
\mathrel{%
    \rlap{\raisebox{-0.25\@kratno@height}{$\mathsurround=0pt#1\cdot$}}%
    \rlap{\raisebox{ 0.00\@kratno@height}{$\mathsurround=0pt#1\cdot$}}%
          \raisebox{ 0.25\@kratno@height}{$\mathsurround=0pt#1\cdot$}%
    }}
\newcommand\kratno{\mathchoice%
    {\@kratno@template{\displaystyle}{\tf@size}}%
    {\@kratno@template{\textstyle}{\tf@size}}%
    {\@kratno@template{\scriptstyle}{\sf@size}}%
    {\@kratno@template{\scriptscriptstyle}{\ssf@size}}%
}
\newcommand\swapvar[2][]{\begingroup
\expandafter\let\expandafter\swap\csname #1#2\endcsname
\expandafter\let\expandafter\varswap\csname #1var#2\endcsname
\global\expandafter\let\csname #1#2\endcsname\varswap
\global\expandafter\let\csname #1var#2\endcsname\swap
\endgroup}
\def\iflabelundefined#1{\expandafter\ifx\csname r@#1\endcsname\relax}
\def\clap#1{\hbox to 0pt{\hss#1\hss}}
\def\mathllap{\mathpalette\mathllapinternal}
\def\mathrlap{\mathpalette\mathrlapinternal}
\def\mathclap{\mathpalette\mathclapinternal}
\def\mathllapinternal#1#2{%
    \llap{$\mathsurround=0pt#1{#2}$}}
\def\mathrlapinternal#1#2{%
    \rlap{$\mathsurround=0pt#1{#2}$}}
\def\mathclapinternal#1#2{%
    \clap{$\mathsurround=0pt#1{#2}$}}
\ProcessOptions
\newcommand\jeolmfiguremap[2]{%
\expandafter\def\csname jeolmfiguremap@#1\endcsname{#2}}
\newcommand\jeolmfigure[2][]{%
\includegraphics[#1]{\csname jeolmfiguremap@#2\endcsname}}
\newcommand\jeolmlabel[1]{\label{#1}}
\newcommand\jeolmref[1]{\ref{#1}}
\newenvironment{jeolmlabelspace}[1]{%
    \renewcommand\jeolmlabel[1]{\label{#1:##1}}%
    \renewcommand\jeolmref[1]{\ref{#1:##1}}%
}{}
\newcommand\jeolmheader{%
    \par\begingroup\small\sffamily%
        \leavevmode\null\hfill%
            {\bfseries\jeolminstitution}%
        \hfill\null\\\null\hfill%
            {\itshape\jeolmdaterange}%
        \qquad
            {\jeolmgroup}%
        \ifx\jeolmdate\relax\else\qquad%
            {\itshape\jeolmdate}%
        \fi%
        \hfill\null\\\rule[1ex]{\textwidth}{0.5pt}\linebreak[0]%
    \endgroup%
    \@nobreaktrue
}
\newcommand\jeolminstitution{Wherever}
\newcommand\jeolmgroup{Whatever}
\newcommand\jeolmdaterange{Whenever}
\let\jeolmdate\relax
\newcommand\problem{\problemx{}}
\newcommand\problemx[1]{\stepcounter{jeolmproblem}%
    \problemyx{\problem@numbering{jeolmproblem}}{#1}}
\newcommand\problemy[1]{\problemyx{#1}{}}
\newcommand\problemyx[2]{\problem@yx{#1}{#2}\problem@space}
\newcommand\subproblem{\subproblemx{}}
\newcommand\subproblemx[1]{\stepcounter{jeolmsubproblem}%
    \subproblemyx{\subproblem@numbering{jeolmsubproblem}}{#1}}
\newcommand\subproblemy[1]{\subproblemyx{#1}{}}
\newcommand\subproblemyx[2]{%
    \subproblem@yx{#1}{#2}%
    \ifmmode\subproblem@space@math\else\subproblem@space\fi}
\let\sp\subproblem
\let\spx\subproblemx
\newcounter{jeolmproblem}
\newcommand\setproblem[1]{\setcounter{jeolmproblem}{#1}}
\newcommand\resetproblem{\setcounter{jeolmproblem}{0}}
\newcommand\problem@numbering{\arabic}
\newcounter{jeolmsubproblem}
\newcommand\resetsubproblem{\setcounter{jeolmsubproblem}{0}}
\newcommand\subproblem@numbering{\alph}
\newcommand\problem@yx[2]{%
    \problem@label{#1}\resetsubproblem
    \problem@format{#1}{#2}}
\newcommand\problem@in@item{\problemx@in@item{}}
\newcommand\problemx@in@item[1]{\problem@yx{\problem@numbering{jeolmproblem}}{#1}}
\newcommand\subproblem@yx[2]{\subproblem@label{#1}\subproblem@format{#1}{#2}}
\newcommand\theproblem{}
\newcommand\problem@label[1]{%
    \global\edef\theproblem{#1}%
    \edef\@currentlabel{\theproblem}}
\newcommand\thesubproblem{}
\newcommand\subproblem@label[1]{%
    \global\edef\thesubproblem{{\theproblem}#1}%
    \edef\@currentlabel{\thesubproblem}}
\newlength\problem@space@length
\problem@space@length=1em
\newcommand\problem@space{\hspace{\problem@space@length}\ignorespaces}
\newcommand\problem@format[2]{\begingroup\bfseries
    #1.\rlap{\!#2}%
\endgroup}
\newlength\subproblem@space@length
\newlength\@subproblem@letter@width
\subproblem@space@length=0.5em
\newcommand\subproblem@space{\hspace{\subproblem@space@length}\ignorespaces}
\newcommand\subproblem@space@math{\mspace{20mu}}
\newcommand\subproblem@format[2]{\text{\begingroup\bfseries
\settowidth{\@subproblem@letter@width}{m}%
(%
    \hspace{0.5\@subproblem@letter@width}%
    \clap{#1\rlap{#2}}%
    \hspace{0.5\@subproblem@letter@width}%
    \phantom{#2}%
)%
\endgroup}}
\newenvironment{problems}{%
\let\itemx\problem@itemx
\let\itemy\problem@itemy
\let\itemyx\problem@itemyx
\begin{list}{\problem@in@item@current}{%
\leftmargin=2.45em\labelsep=\problem@space@length%
\@nmbrlisttrue\def\@listctr{jeolmproblem}}%
}{\end{list}}
\let\problem@in@item@current\problem@in@item
\newcommand\problem@itemx[1]{%
\def\problem@in@item@current{\problemx@in@item{#1}}%
\item%
\let\problem@in@item@current\problem@in@item}
\newcommand\problem@itemy[1]{%
\item[\problem@format{#1}{}]\problem@label{#1}\resetsubproblem}
\newcommand\problem@itemyx[2]{%
\item[\problem@format{#1}{#2}]\problem@label{#1}\resetsubproblem}
\newcommand\claim[1]{\claim@format{#1}}
\newcommand\claim@format[1]{\noindent\textbf{#1.\enspace}\ignorespaces}
\newcommand\theorem{\claim{Теорема}}
\newcommand\theoremof[1]{\claim{Теорема #1}}
\newcommand\definition{\claim{Определение}}
\newcommand\lemma{\claim{Лемма}}
\newcommand\statement{\claim{Утверждение}}
